export default class RÃ¸ut{constructor(a,b={}){return this._routes=a,this._internalDefaults={method:"path",redirect404:!1,entryPoint:"index",useRender:!0,renderTarget:document.querySelector("body"),resetScroll:!0},this._options=Object.assign(this._internalDefaults,b),window.addEventListener("hashchange",this._match.bind(this,window.location)),window.addEventListener("load",this._match.bind(this,window.location)),this}create(a,b,c=[]){let d=this._routes[c[0]]?this._routes[c[0]]:void 0;for(let e=1;e<c.length;e++)d[c[e]]?d=d[c[e]]:(d[c[e]]={},d=d[c[e]]);return d?(d[a]=b,d[a]):(this._routes[a]=b,this._routes[a])}remove(a){if("#"!=a[0])throw new Error("Route syntax incorrect. Leading # required.");let b=this._parse(a);if(0===b.path.length)delete this._routes[b.hash];else{let a=this._routes[b.path[0]];for(let c=1;c<b.path.length;c++)if(a.children[b.path[c]]&&c<b.path.length-1)a=a.children[b.path[c]];else return delete a.children[b.path[c]],0===Object.keys(a.children).length&&a.constructor===Object&&delete a.children,!0}return!1}reset(){this._routes={}}_match(a){if("object"==!typeof a||!a.hash==null)throw new Error("Passed argument is not a window.location object.");let b=this._parse(a.hash);const c=a=>{let b=document.querySelector("title");return!!a.hasOwnProperty("title")&&void(b.textContent=a.title)},d=()=>{window.location.hash=this._options.redirect404||!this._routes[404]?"#":"path"===this._options.method?"#/404":"#404"};if("hash"===this._options.method)this._routes[b.hash]?(this._options.useRender?(this._options.resetScroll?window.scrollTo(0,0):null,this._render(this._options.renderTarget,this._routes[b.hash].template,b.query)):this._routes[b.hash].callback(b.query),c(this._routes[b.hash])):d();else if("path"===this._options.method){let a=(a=>{let b;if(0===a.length)return this._routes[this._options.entryPoint];if(this._routes[a[0]])b=this._routes[a[0]];else return!1;if(b.children||0!=a.length)for(let c=1;c<a.length;c++)if(b.children&&b.children[a[c]])b=b.children[a[c]];else return!1;return b})(b.path);a?(this._options.useRender?(this._options.resetScroll?window.scrollTo(0,0):null,this._render(this._options.renderTarget,a.template,b.query)):a.callback(b.query),window.history.replaceState({},a.title,`/${b.path.join("/")}${0==b.query.toString().length?"":"?"+b.query.toString()}`),c(a)):d()}else throw new Error("Incorrect Method set. 'path' or 'hash' possible.")}_parse(a){let b={hash:""===a?this._options.entryPoint:a.match(/#.?(?=\/)|#.*(?=\/)|#.*/gim)[0].replace("#","")},c=a.match(/\/.*(?=\/)|\/.*(?=\?)|\/.*(?=)/gim)||[];return c=c.map(a=>a.replace("/","")),b.path=c,b.query=new URLSearchParams(a.split("?")[1]),b}_parseRouteName(a,b){return a.includes("/")?a.split("/").reduce((a,b)=>a[b],b):b[a]}async _render(a,b,c){const d=new DOMParser;let e=await b(c),f=d.parseFromString(e,"text/html").querySelector("template");for(;a.firstElementChild;)a.firstElementChild.remove();a.appendChild(f.content)}}